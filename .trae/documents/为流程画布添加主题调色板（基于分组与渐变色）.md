## 目标
- 在 ASM1、ASM3、ASM1Slim、MaterialBalance 画布上引入“主题调色板”，支持分组配色与渐变系列色，并影响玻璃风格的主色（accent）、描边（outline）、把手与面板背景。
- 在画布底部操作条左侧的“保存与导入”按钮右侧新增一个“主题色板”按钮，点击后弹出选择面板，可一键应用预设或自定义基色与模式。

## 现状与定位
- 玻璃风格与颜色：集中在 `components/Flow/nodes/utils/glass.ts`，以 tint 映射控制背景、accent、outline、handle 等：
  - 背景引用 CSS 变量：`GLASS_BG[tint]`（glass.ts:28–38）。
  - 描边与主色为静态 HSLA：`OUTLINE_COLORS`（glass.ts:40–50）、`ACCENT_COLORS`（glass.ts:52–62）。
  - 组件样式入口：`getGlassNodeStyles`（glass.ts:113），`getHandleStyle`（glass.ts:174）。
- 画布与缩略图颜色：`FlowCanvas` 使用 `getAccentColor(resolveTintFromNodeType(...))` 给 MiniMap 节点上色（FlowCanvas.tsx:259–263）。
- 底部操作条位置：新增按钮将放在 `SimulationActionPlate.tsx` 底部条（约 790–971），现有“保存与导入”菜单按钮位于左下（SimulationActionPlate.tsx:793–895）。
- 路由页引用统一的 FlowLayout/FlowCanvas/Inspector；无需调整路由文件本身。

## 设计方案
- 统一“主题调色板”状态：新增一个全局 palette store（Zustand），供所有模型画布共享；包含：
  - `scheme`: `'monochromatic' | 'complementary' | 'analogous' | 'triadic' | 'tab10' | 'extended'`。
  - `baseColor`: 选定基色（十六进制）。
  - `steps`: 生成色数（默认 6–8）。
  - `palette`: 计算后颜色数组。
  - `applyPalette(tintOrder?: GlassTint[])`: 把 `palette` 写入 CSS 变量，覆盖各 tint 的 accent/outline/handle 与背景。
  - `reset()`: 恢复到现有 HSLA 默认配置。
- CSS 变量覆盖策略：
  - 为每个 tint 写入：`--chakra-colors-glass-accent-<tint>`、`--chakra-colors-glass-outline-<tint>`、`--chakra-colors-glass-handle-<tint>`、（可选）`--chakra-colors-glass-tint-<tint>` 背景。
  - 修改 `glass.ts` 使 `ACCENT_COLORS`、`OUTLINE_COLORS`、`HANDLE_COLORS` 读取上述变量并以当前 HSLA 作为默认值（与 `GLASS_BG` 的做法保持一致）。
  - 优点：无需大规模改动节点组件，现有 `getAccentColor`/`getOutlineColor` 自动反映主题变更。
- Tint 与颜色分配规则：
  - 全局 `TINT_ORDER`: `['input','output','asm1','asm3','asmslim','default','cash','goal','traffic']`。
  - 根据所选 `scheme` 生成 `palette`，按顺序赋值；不足时循环取色。
  - MaterialBalance 仅使用 `default/input/output`，其余保留默认或循环分配。

## 颜色生成逻辑（复用现有工具）
- 渐变系列：`buildColorScaleFromBase(base, steps)`（colorSchemes.ts:231–247）。
- 分组组合：`generateGroupedColors(base, type)` 返回主次色（colorSchemes.ts:527–556），再分别用 `buildColorScaleFromBase` 生成两条渐变并合并。
- 预设色板：提供 `TAB10_COLORS`（colorSchemes.ts:72–96）与 `EXTENDED_COLOR_PALETTE`（colorSchemes.ts:329–412）作为快捷基色选择；也支持科学色板预览但不混入组件主题（仅作为参考）。

## UI 改动
- 在 `SimulationActionPlate.tsx` 底部左侧区域“保存与导入”按钮旁新增“主题色板”按钮：
  - 样式沿用 `getToggleButtonStyles`/`getBubbleButtonStyles`，保持玻璃风格与交互一致。
  - 点击后弹出圆弧式气泡面板（沿用 `computeArcPositions`），包含：
    - 模式选择：Monochromatic/Complementary/Analogous/Triadic。
    - 基色选择：若干色块（来自 `EXTENDED_COLOR_PALETTE`，支持十六进制输入框）。
    - 预览条：实时显示生成的 `palette`。
    - 操作：`应用`（调用 `applyPalette`）、`重置`（还原默认），并关闭面板。

## 应用与集成
- 修改 `glass.ts`：把 `ACCENT_COLORS`/`OUTLINE_COLORS`/`HANDLE_COLORS` 改为 `var(--chakra-colors-glass-accent-<tint>, hsla(...))` 等格式（保留现有 HSLA 作为 fallback）。
- 新建 `stores/themePaletteStore.ts`：封装 `scheme/baseColor/steps/palette/apply/reset`；在 `apply` 中统一写入 `document.documentElement.style.setProperty(...)`。
- 在 `SimulationActionPlate.tsx` 中：
  - 引入 palette store 与 `colorSchemes.ts` 的生成函数。
  - 按当前 `modelType` 提前设定 tint 分配优先（例如 ASM1 优先 `asm1→input→output→default`）。
  - 触发 `applyPalette` 后无需刷新节点，样式即时生效；MiniMap 颜色也通过 `getAccentColor` 变化。

## 路由适配
- 路由页（`asm1.tsx`、`asm3.tsx`、`asm1slim.tsx`、`materialbalance.tsx`）保持不变；主题仅通过底部操作条及 CSS 变量驱动，避免侵入式改动。

## 验证
- 运行类型检查：`cd frontend; npx tsc --noEmit`。
- 启动前端：`cd frontend; npm run dev`，在四个路由分别测试：
  - 切换模式/基色后：节点边框、accent、把手与 MiniMap 颜色随主题更新。
  - 重置后：恢复原始 HSLA 效果。
- 检查 WCAG 对比度（复用 `isWCAGCompliant`），防止极端低对比主题。

## 交付
- 更新 `glass.ts` 变量读取。
- 新增 `stores/themePaletteStore.ts`。
- 更新 `SimulationActionPlate.tsx` 增加按钮与面板逻辑。
- 复用 `colorSchemes.ts` 生成逻辑，无其他文件结构变更。

如确认上述方案，我将按此实现并进行验证。