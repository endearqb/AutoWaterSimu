按“工程师能独立建模 + 能排错 + 能扩展到自定义模型/控制”的目标，以下是一套**可直接开写的完整教程大纲**：含 1 页知识地图、16 章路线、每章都配 **最小例题 / 诊断题 / 错因库条目**（后续只要往里填图和数据就能成体系）。

---

## 0）教程定位与读者假设（写在序言里，能大幅减少误解）

**目标读者**

* 污水/工业废水工程师：懂工艺与指标，但不一定熟数值仿真
* 会一点点代码/愿意点点鼠标的建模者：想用流程图快速搭可计算模型

**教程产出**

1. 能从“业务问题”抽象出状态量/过程/边界
2. 能用流程图搭出可跑的动态模型
3. 能用守恒+单位+极限工况快速排错
4. 能做校准（至少从默认→局部校准）
5. 能扩展：新增状态、写自定义过程、接控制/二沉/外部计算（如 pH/碱度模块）

---

## 1）1 页知识地图（建议做成你教程的“总导航”）

你可以用下面这个结构直接画成一张图（模块→先修→产出）：

**A. 画布与计算内核**

* 先修：无
* 产出：会画节点/连线、知道每条边的物理意义（流量/通量/信号）

**B. 水力与混合（舞台）**

* 先修：A
* 产出：CSTR/推流近似、停留时间、回流/分流、边界条件

**C. 物料衡算（骨架）**

* 先修：B
* 产出：单位体系、守恒检查、质量流率、稳态/动态一致性

**D. 生化动力学（剧本）**

* 先修：C
* 产出：状态量/过程/速率、Petersen 思想、参数意义与敏感性

**E. 数值稳定与调试（工程化）**

* 先修：A–D
* 产出：时间步长、刚性、负浓度、爆炸曲线定位方法

**F. 校准与不确定性（交付）**

* 先修：E
* 产出：校准顺序、目标函数、参数边界、可解释报告

**G. 扩展模块（护城河）**

* 先修：D–F
* 产出：自定义过程、二沉/污泥线、控制策略、外部模块耦合

---

## 2）16 章教程路线图（每章都带：最小例题 / 诊断题 / 错因库）

> 你可以把每章当成“一个可交付的能力单元”，每章结尾都能产出一个可复用模板。

### 第 1 章：你的流程图模型到底在算什么？

* **目标**：把“画图”与“方程组”对应起来（节点=状态、边=通量/输入）
* **最小例题**：1 个完全混合池 + 1 个进水 + 1 个出水，模拟某组分浓度阶跃响应
* **诊断题**：给一个模型，结果“稳态浓度 > 进水浓度”——找出边界条件/方向错误
* **错因库**：流向反了、Q 单位错（m³/d vs m³/h）、初值没设导致误读

### 第 2 章：单位体系与“守恒三件套”

* **目标**：建立统一单位（推荐：流量 m³/d，浓度 mg/L，质量 kg）
* **最小例题**：把同一问题用两套单位跑一遍，证明结果一致
* **诊断题**：输出曲线振幅差 24 倍——定位“天/小时”混用
* **错因库**：mg/L ↔ kg/d 换算、体积与流量的时间基准不一致

### 第 3 章：混合模型：CSTR、串联 CSTR、推流近似

* **目标**：用“舞台”刻画水力；知道何时用串联近似推流
* **最小例题**：3 个 CSTR 串联逼近推流，比较峰值与滞后
* **诊断题**：串联后峰值更早了（不合理）——找连线方向/体积设置问题
* **错因库**：各池体积未分配、内部回流误加在主流上

### 第 4 章：从业务 KPI 到状态量选择（“保留/合并/忽略”规则）

* **目标**：让用户学会“少而准”的状态集（避免一上来全 ASM）
* **最小例题**：只建 COD+NH₄+DO 三状态的简化活性污泥池
* **诊断题**：DO 一直负值——定位曝气项符号/饱和浓度设置
* **错因库**：把“输入负荷”当成“浓度源项”、状态漏掉氧转移驱动

### 第 5 章：过程（Process）与速率（Rate）：你画的每个反应到底是什么

* **目标**：把“过程节点”写成可解释速率：限制项、Monod、抑制项
* **最小例题**：1 个好氧降解过程：速率 = μ·S/(Ks+S)·X
* **诊断题**：S 降得比指数还快——定位速率上限/单位错（μ 的时间基准）
* **错因库**：μ 用了 1/h 但仿真按天、X 与 S 的单位不一致

### 第 6 章：Petersen 思想的落地：用矩阵组织你的模型

* **目标**：让读者理解“状态×过程”系数矩阵如何自动生成方程
* **最小例题**：2 状态 2 过程的小矩阵（一个生成、一个消耗），自动拼 dC/dt
* **诊断题**：总 COD 不守恒——找出化学计量系数的符号或漏项
* **错因库**：行列含义混了、过程速率单位与化学计量不匹配

### 第 7 章：氮循环最小闭环：NH₄ → NO₂/NO₃ → N₂（逐步加复杂度）

* **目标**：先跑通氮，再谈精细化（短程、分段反硝化等）
* **最小例题**：1 段硝化 + 1 段反硝化，展示碱度/需氧的直觉影响（可选）
* **诊断题**：反硝化越强 TN 越高——定位 NOx 流向与过程选择错误
* **错因库**：反硝化把 NOx 当“产物”、缺碳源限制导致误解

### 第 8 章：溶解氧与曝气：把控制变量接进模型（即使先用开环）

* **目标**：DO 动态、氧转移（简化 KLa 也行）、曝气作为输入信号
* **最小例题**：给定曝气曲线，观察 DO 与硝化速率耦合
* **诊断题**：DO 一直贴着饱和值但耗氧巨大——定位 KLa/饱和浓度/单位
* **错因库**：KLa 的时间单位、Cs 用温度但模型没温度模块

### 第 9 章：污泥龄 SRT 与排泥：把“运行策略”变成可计算边界

* **目标**：排泥流量如何影响 X、硝化能力与稳定性
* **最小例题**：固定进水，比较不同排泥下 X 的稳态与氨氮出水
* **诊断题**：加大排泥 X 反而上升——定位排泥口接错位置/符号
* **错因库**：排泥当成“回流”、排泥浓度取错（应取池内/底流）

### 第 10 章：二沉/分离最小模型：先用“分离效率”，再进阶到层模型

* **目标**：让流程图支持“固液分离对生化的反作用”（回流、出水SS）
* **最小例题**：二沉用一个分离系数（X_out = α·X_in），形成回流闭环
* **诊断题**：回流越大出水越清但池内 X 不变——定位回流未真正回到生化池
* **错因库**：回流线接到错节点、分离模型只改了出水没改回流浓度

### 第 11 章：数值稳定与“爆炸曲线”排查（非常关键）

* **目标**：教会读者 10 分钟定位数值/结构性错误
* **最小例题**：同一模型用不同步长比较；展示刚性导致的假震荡
* **诊断题**：出现负浓度/NaN ——按流程定位：步长→速率上限→边界→矩阵符号
* **错因库**：刚性系统步长过大、速率项不做非负截断、指数溢出

### 第 12 章：校准 101：从默认参数到“只校准必要的那几个”

* **目标**：给出可操作的校准顺序（别一上来全参数）
* **最小例题**：用 NH₄ 与 DO 两条曲线校准：μA、KLa（示例）
* **诊断题**：拟合很好但参数离谱——识别不可辨识与参数共线
* **错因库**：多个参数同效应、目标函数没加正则/边界

### 第 13 章：敏感性分析与不确定性：让模型“可解释”

* **目标**：让用户知道“哪个参数最影响 KPI”，输出工程决策建议
* **最小例题**：对 3–5 个关键参数做单因子扰动，比较出水 TN
* **诊断题**：敏感性结果完全反常——定位扰动幅度/单位/稳态未收敛
* **错因库**：没等系统到准稳态就比较、扰动跨越了模型适用区

### 第 14 章：自定义模型（UDM）工作流：从矩阵到可计算画布

* **目标**：把“用户维护矩阵→自动抽取变量/参数→生成画布”讲成规范
* **最小例题**：用户新增一个“抑制过程”，系统自动生成参数输入与范围
* **诊断题**：新增过程后模型无法求解——定位：过程速率单位/缺少状态/循环依赖
* **错因库**：参数缺省值不合理、过程引用了不存在的状态

### 第 15 章：控制策略接入：PID/规则控制如何作用到曝气/回流/加药

* **目标**：把“控制器”当作信号模块接入流程图（先离散，再连续）
* **最小例题**：DO 控制曝气：设定值阶跃，观察过冲与恢复
* **诊断题**：控制越调越发散——定位符号（正/负反馈）与采样周期
* **错因库**：控制方向反了、积分饱和、控制周期与仿真步长不匹配

### 第 16 章：交付与复用：模板化、版本化、审计化（写给“你未来的用户与团队”）

* **目标**：把模型变成可复用资产：模板、参数集、校准记录、报告
* **最小例题**：同一模型打包成“工程模板”：默认参数 + 校准参数 + 运行场景
* **诊断题**：别人复用跑不出同样结果——定位：数据版本/初值/边界文件
* **错因库**：输入数据没锁版本、初值随机、场景配置散落

---

## 3）你可以直接复用的“练习分层 + 反馈机制”写法（建议固定为每章末尾）

**练习：3+1**

* 基础：照着做能跑通（重点：单位、守恒、方向）
* 提高：加一个真实约束（回流/控制/SRT/二沉）
* 挑战：新增状态或过程（进入 UDM/扩展能力）
* 诊断：给坏模型找 bug（最节省你答疑时间）

**反馈：答案包的最小组成**

1. 参考画布（截图/导出 JSON）
2. 参考参数表（含单位与范围）
3. 关键输出曲线（2–4 条就够）
4. “三条自检”：守恒、极限工况、单位
5. 错因库链接：出现某现象 → 可能原因 → 处理顺序

---

## 4）下一步我建议你立刻做的 3 个“样章”（最能定调）

为了最快把风格立起来、也方便后续批量写，我建议先写这 3 章为样板：

1. **第 2 章（单位与守恒）**：奠定工程严谨性
2. **第 6 章（矩阵组织模型）**：奠定你的独特方法论
3. **第 11 章（数值稳定与排错）**：奠定“用得起来”的口碑

---

如果你认可这条路线，我可以继续把它**工程化到“可直接开写”**的程度：

* 给你一份统一的**术语/符号/单位规范**（避免全书不一致）
* 给每章补齐“**最小例题的具体数值设定**”（体积、流量、进水、参数初值、期望曲线形状）
* 给一套“**错因库索引表**”（现象→原因→检查项→修复动作）

希望这套教程更偏我自己的 **UDM（矩阵驱动 + 可视化画布）**为主、ASM 只是示例。
