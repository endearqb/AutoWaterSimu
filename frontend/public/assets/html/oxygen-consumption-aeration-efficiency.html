<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式污水生物处理参数分析平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Warm Neutral & Calm Blue -->
    <!-- Application Structure Plan: The application is designed as a guided, thematic journey through four interactive modules, rather than a linear report. This structure promotes active learning and discovery. 1) 'Microbial Activity' visualizes the biological engine's response to load. 2) 'Aeration Efficiency' provides an interactive calculator to explore the critical SOTE-AOTE conversion and alpha-factor tradeoffs. 3) 'Process Control' simulates the key SRT-Temperature relationship, linking strategic decisions to operational reality. 4) 'Integrated Explorer' uses an interactive concept map to synthesize all concepts, revealing the complex feedback loops. This modular, task-oriented design breaks down complexity and empowers users to understand the system by manipulating its core variables. -->
    <!-- Visualization & Content Choices: 1. (Microbial Activity) Goal: Inform/Show Change. Viz: Chart.js line chart. Interaction: Buttons to toggle load scenarios, updating the chart. Justification: Visually demonstrates the direct impact of influent on oxygen demand. 2. (Aeration Efficiency) Goal: Compare/Show Relationships. Viz: Chart.js bar chart & dynamic text readouts. Interaction: Sliders (MLSS, Temp) and dropdowns (Tech, Wastewater Type) update calculations and visuals in real-time. Justification: Transforms the static AOTE formula into a tangible tool for exploring trade-offs. 3. (Process Control) Goal: Show Constraints. Viz: Chart.js bar chart. Interaction: Temperature slider updates required SRT based on report data. Justification: Clearly illustrates the critical design constraint of nitrification in cold weather. 4. (Integrated Explorer) Goal: Organize/Synthesize. Viz: Interactive concept map using styled HTML divs and CSS. Interaction: Clicking a concept node highlights its connections and displays detailed contextual information. Justification: Makes the abstract system feedback loops tangible and explorable without using forbidden SVG/Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #F8F9FA;
            color: #343A40;
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-button.active, .nav-button:hover {
            border-bottom-color: #4A90E2;
            color: #4A90E2;
            transform: translateY(-2px);
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.07), 0 15px 25px rgba(0, 0, 0, 0.07);
            transform: translateY(-2px);
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            max-height: 40vh;
            width: 100%;
            max-width: 800px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4A90E2;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .param-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4A90E2;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .concept-node {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .concept-node.active {
            border-color: #4A90E2;
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
            transform: scale(1.05);
        }
        .concept-line {
            position: absolute;
            background-color: #ADB5BD;
            transition: all 0.3s ease;
        }
        .concept-line.active {
            background-color: #4A90E2;
            z-index: 10;
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-40 w-full border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-4">
                    <div class="p-2 bg-blue-100 rounded-full">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    </div>
                    <h1 class="text-xl md:text-2xl font-bold text-gray-800">污水生物处理交互分析平台</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-8 text-gray-600 font-medium">
                    <a href="#section-bio" class="nav-button active">微生物活性</a>
                    <a href="#section-aeration" class="nav-button">曝气效率</a>
                    <a href="#section-control" class="nav-button">工艺控制</a>
                    <a href="#section-explorer" class="nav-button">集成探索</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 space-y-16">

        <section id="section-bio" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800">1. 微生物活性监测</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">
                    本模块将带您深入了解污水处理的“生物引擎”核心。我们将探索耗氧速率（OUR）与氨利用速率（AUR），它们是衡量微生物工作状态的关键实时指标。通过下方的交互图表，您可以直观感受进水负荷变化如何直接影响系统的瞬时需氧量。
                </p>
            </div>
            <div class="card p-4 md:p-8">
                <div class="flex justify-center mb-6 space-x-4">
                    <button id="load-low-btn" class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 transition">常规负荷日</button>
                    <button id="load-high-btn" class="px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75 transition">高负荷冲击日</button>
                </div>
                <div class="chart-container">
                    <canvas id="ourChart"></canvas>
                </div>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-700">耗氧速率 (OUR)</h4>
                        <p class="text-sm text-gray-500">衡量总代谢活性，单位 mg O₂/L/hr。</p>
                        <p id="our-value" class="text-2xl font-bold text-blue-600 mt-2">-</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-700">比耗氧速率 (SOUR)</h4>
                        <p class="text-sm text-gray-500">单位生物量的活性，单位 mg O₂/gVSS/hr。</p>
                        <p id="sour-value" class="text-2xl font-bold text-blue-600 mt-2">-</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-700">氨利用速率 (AUR)</h4>
                        <p class="text-sm text-gray-500">衡量硝化细菌的活性，单位 mg N/L/hr。</p>
                        <p id="aur-value" class="text-2xl font-bold text-green-600 mt-2">-</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-700">总需氧量 (AOR)</h4>
                        <p class="text-sm text-gray-500">OUR+AUR，系统总需求。</p>
                        <p id="aor-value" class="text-2xl font-bold text-red-600 mt-2">-</p>
                    </div>
                </div>
            </div>
        </section>

        <hr class="border-gray-200">

        <section id="section-aeration" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800">2. 曝气系统效率分析</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">
                    曝气是污水厂的能耗大户。本模块提供一个交互式计算器，揭示曝气系统的“出厂效率”（SOTE）与“现场实际效率”（AOTE）之间的巨大差异。请您亲手调节废水类型、曝气技术、MLSS浓度和温度等参数，探索它们如何通过影响关键的α因子，最终决定曝气的真实成本。
                </p>
            </div>
            <div class="card p-4 md:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 space-y-6">
                        <div>
                            <label for="aeration-tech" class="font-semibold text-gray-700">曝气技术</label>
                            <select id="aeration-tech" class="mt-2 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="fine_pore">微孔曝气</option>
                                <option value="coarse_pore">粗孔曝气</option>
                                <option value="jet">射流/机械曝气</option>
                            </select>
                        </div>
                        <div>
                            <label for="wastewater-type" class="font-semibold text-gray-700">废水类型</label>
                            <select id="wastewater-type" class="mt-2 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="municipal">市政污水</option>
                                <option value="industrial">工业废水</option>
                            </select>
                        </div>
                        <div>
                            <label for="mlss-slider" class="font-semibold text-gray-700">MLSS 浓度: <span id="mlss-label" class="font-bold text-blue-600"></span> mg/L</label>
                            <input id="mlss-slider" type="range" min="2000" max="12000" value="4000" step="500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider mt-2">
                        </div>
                        <div>
                            <label for="temp-slider" class="font-semibold text-gray-700">水温: <span id="temp-label" class="font-bold text-blue-600"></span> °C</label>
                            <input id="temp-slider" type="range" min="5" max="30" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider mt-2">
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="chart-container">
                            <canvas id="aoteChart"></canvas>
                        </div>
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-bold text-gray-700">Alpha (α) 因子</h4>
                                <p id="alpha-value" class="text-3xl font-bold text-blue-600 mt-2"></p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-bold text-gray-700">Beta (β) 因子</h4>
                                <p id="beta-value" class="text-3xl font-bold text-green-600 mt-2"></p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-bold text-gray-700">总校正系数</h4>
                                <p id="correction-factor" class="text-3xl font-bold text-red-600 mt-2"></p>
                            </div>
                        </div>
                         <div id="aote-explanation" class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="border-gray-200">

        <section id="section-control" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800">3. 工艺控制模拟器</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">
                    固体停留时间（SRT）是污水厂运行的“主控变量”，它决定了微生物群落的结构。本模拟器将聚焦于SRT与温度之间的关键关系，尤其是在确保硝化作用方面。请拖动温度滑块，观察在不同季节条件下，为了留住宝贵的硝化菌，系统需要维持的最小SRT。
                </p>
            </div>
             <div class="card p-4 md:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div>
                         <div class="mb-6">
                            <label for="srt-temp-slider" class="font-semibold text-gray-700">设定废水温度: <span id="srt-temp-label" class="font-bold text-blue-600"></span> °C</label>
                            <input id="srt-temp-slider" type="range" min="8" max="20" value="15" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider mt-2">
                        </div>
                        <div class="chart-container" style="height: 280px;">
                             <canvas id="srtChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                            <h3 class="text-xl font-bold text-gray-800">关键解读：</h3>
                            <div id="srt-explanation"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="border-gray-200">

        <section id="section-explorer" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800">4. 集成关系浏览器</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">
                    活性污泥系统是一个复杂的网络，各个参数相互关联、相互制约。本浏览器通过一张交互式概念图，将所有关键参数整合在一起。请点击图中的任意节点，高亮其关联路径，并在右侧查看其详细的功能和影响解读，从而建立一个完整的、系统性的认知框架。
                </p>
            </div>
            <div class="card p-4 md:p-8">
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 relative h-[500px] bg-gray-50 rounded-lg p-4" id="concept-map-container">
                    </div>
                    <div class="lg:col-span-1">
                        <div id="concept-info-panel" class="p-6 bg-white rounded-lg border border-gray-200 h-full min-h-[400px]">
                           <h3 id="concept-title" class="text-2xl font-bold text-blue-600 mb-4">请选择一个节点</h3>
                           <p id="concept-text" class="text-gray-600 leading-relaxed">点击左侧图中的概念节点（如 SRT, MLSS），此处将显示其详细定义、在系统中的作用以及与其他参数的相互关系。</p>
                        </div>
                    </div>
                 </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto py-8 px-4 text-center">
            <p>交互式污水生物处理参数分析平台</p>
            <p class="text-sm text-gray-400 mt-2">基于技术报告内容，旨在提供教育和分析工具。</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const navigation = {
                setupNavHighlighting: () => {
                    const sections = document.querySelectorAll('section');
                    const navLinks = document.querySelectorAll('.nav-button');
                    
                    window.addEventListener('scroll', () => {
                        let current = '';
                        sections.forEach(section => {
                            const sectionTop = section.offsetTop;
                            if (pageYOffset >= sectionTop - 120) {
                                current = section.getAttribute('id');
                            }
                        });

                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${current}`) {
                                link.classList.add('active');
                            }
                        });
                    });

                    navLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            document.querySelector(link.getAttribute('href')).scrollIntoView({
                                behavior: 'smooth'
                            });
                        });
                    });
                }
            };

            const microbialActivity = {
                chart: null,
                ourValueEl: document.getElementById('our-value'),
                sourValueEl: document.getElementById('sour-value'),
                aurValueEl: document.getElementById('aur-value'),
                aorValueEl: document.getElementById('aor-value'),
                loadLowBtn: document.getElementById('load-low-btn'),
                loadHighBtn: document.getElementById('load-high-btn'),
                
                data: {
                    low: {
                        labels: Array.from({ length: 24 }, (_, i) => `${i}:00`),
                        our: [15, 12, 10, 10, 12, 18, 25, 35, 40, 45, 42, 38, 35, 30, 32, 38, 40, 35, 30, 25, 20, 18, 16, 15],
                        aur: [3, 2, 2, 2, 3, 5, 8, 12, 15, 16, 15, 13, 11, 10, 11, 13, 14, 12, 10, 8, 6, 5, 4, 3]
                    },
                    high: {
                        labels: Array.from({ length: 24 }, (_, i) => `${i}:00`),
                        our: [20, 18, 15, 15, 18, 25, 35, 50, 60, 65, 62, 55, 50, 45, 48, 55, 58, 50, 45, 38, 30, 25, 22, 20],
                        aur: [5, 4, 4, 4, 5, 8, 12, 18, 22, 25, 23, 20, 18, 16, 18, 20, 21, 18, 15, 12, 9, 7, 6, 5]
                    }
                },
                
                init: function() {
                    const ctx = document.getElementById('ourChart').getContext('2d');
                    this.chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: this.data.low.labels,
                            datasets: [
                                {
                                    label: 'OUR (mg O₂/L/hr)',
                                    data: this.data.low.our,
                                    borderColor: 'rgba(74, 144, 226, 1)',
                                    backgroundColor: 'rgba(74, 144, 226, 0.2)',
                                    tension: 0.4,
                                    fill: true,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'AUR (mg N/L/hr)',
                                    data: this.data.low.aur,
                                    borderColor: 'rgba(72, 191, 149, 1)',
                                    backgroundColor: 'rgba(72, 191, 149, 0.2)',
                                    tension: 0.4,
                                    fill: true,
                                    yAxisID: 'y'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: '速率 (mg/L/hr)'
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        footer: (tooltipItems) => {
                                            const our = tooltipItems.find(item => item.datasetIndex === 0).raw;
                                            const aur = tooltipItems.find(item => item.datasetIndex === 1).raw;
                                            this.updateValues(our, aur);
                                            return `总需氧量 (AOR): ${(our + aur).toFixed(1)} mg/L/hr`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    this.loadLowBtn.addEventListener('click', () => this.updateLoad('low'));
                    this.loadHighBtn.addEventListener('click', () => this.updateLoad('high'));
                    
                    this.updateLoad('low');
                },

                updateLoad: function(level) {
                    this.chart.data.datasets[0].data = this.data[level].our;
                    this.chart.data.datasets[1].data = this.data[level].aur;
                    this.chart.update();

                    this.loadLowBtn.classList.toggle('bg-blue-500', level === 'low');
                    this.loadLowBtn.classList.toggle('text-white', level === 'low');
                    this.loadLowBtn.classList.toggle('bg-gray-200', level !== 'low');
                    this.loadLowBtn.classList.toggle('text-gray-800', level !== 'low');

                    this.loadHighBtn.classList.toggle('bg-blue-500', level === 'high');
                    this.loadHighBtn.classList.toggle('text-white', level === 'high');
                    this.loadHighBtn.classList.toggle('bg-gray-200', level !== 'high');
                    this.loadHighBtn.classList.toggle('text-gray-800', level !== 'high');

                    const peakOur = Math.max(...this.data[level].our);
                    const peakAur = Math.max(...this.data[level].aur);
                    this.updateValues(peakOur, peakAur);
                },

                updateValues: function(our, aur) {
                    const mlss = aerationAnalysis.getValues().mlss; 
                    const vss = mlss * 0.75 / 1000;
                    const sour = our / vss;
                    
                    this.ourValueEl.textContent = our.toFixed(1);
                    this.sourValueEl.textContent = sour.toFixed(1);
                    this.aurValueEl.textContent = aur.toFixed(1);
                    this.aorValueEl.textContent = (our + aur).toFixed(1);
                }
            };
            
            const aerationAnalysis = {
                chart: null,
                techEl: document.getElementById('aeration-tech'),
                wasteEl: document.getElementById('wastewater-type'),
                mlssSlider: document.getElementById('mlss-slider'),
                tempSlider: document.getElementById('temp-slider'),
                mlssLabel: document.getElementById('mlss-label'),
                tempLabel: document.getElementById('temp-label'),
                alphaValueEl: document.getElementById('alpha-value'),
                betaValueEl: document.getElementById('beta-value'),
                correctionFactorEl: document.getElementById('correction-factor'),
                explanationEl: document.getElementById('aote-explanation'),

                settings: {
                    sote: { fine_pore: 60, coarse_pore: 30, jet: 25 },
                    base_alpha: {
                        fine_pore: { municipal: 0.55, industrial: 0.4 },
                        coarse_pore: { municipal: 0.85, industrial: 0.8 },
                        jet: { municipal: 0.9, industrial: 0.9 }
                    },
                    beta: { municipal: 0.95, industrial: 0.90 }
                },

                init: function() {
                    const ctx = document.getElementById('aoteChart').getContext('2d');
                    this.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['标准效率 (SOTE)', '实际效率 (AOTE)'],
                            datasets: [{
                                label: '氧转移效率 (%)',
                                data: [0, 0],
                                backgroundColor: [
                                    'rgba(173, 216, 230, 0.6)',
                                    'rgba(74, 144, 226, 0.6)'
                                ],
                                borderColor: [
                                    'rgba(173, 216, 230, 1)',
                                    'rgba(74, 144, 226, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 70,
                                    title: { display: true, text: '效率 (%)' }
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                    
                    this.techEl.addEventListener('change', this.update.bind(this));
                    this.wasteEl.addEventListener('change', this.update.bind(this));
                    this.mlssSlider.addEventListener('input', this.update.bind(this));
                    this.tempSlider.addEventListener('input', this.update.bind(this));
                    
                    this.update();
                },

                getValues: function() {
                    return {
                        tech: this.techEl.value,
                        waste: this.wasteEl.value,
                        mlss: parseInt(this.mlssSlider.value),
                        temp: parseInt(this.tempSlider.value)
                    };
                },

                calculate: function() {
                    const { tech, waste, mlss, temp } = this.getValues();
                    
                    let alpha = this.settings.base_alpha[tech][waste];
                    const mlss_factor = 1 - ((mlss - 2000) / 10000) * (tech === 'fine_pore' ? 0.4 : 0.15);
                    alpha *= mlss_factor;
                    
                    const beta = this.settings.beta[waste];
                    const sote = this.settings.sote[tech];
                    const C_L = 2.0;
                    
                    const C_s_T_clean = 14.652 - 0.41022 * temp + 0.007991 * temp**2 - 0.000077774 * temp**3;
                    const C_s_T_waste = C_s_T_clean * beta;
                    const C_s_20_clean = 9.09;

                    const tempCorrection = 1.024**(temp - 20);
                    
                    const correctionFactor = alpha * tempCorrection * (((C_s_T_waste - C_L) / C_s_20_clean));
                    
                    const aote = sote * correctionFactor;

                    return { sote, aote, alpha, beta, correctionFactor };
                },

                update: function() {
                    const { tech, mlss, temp } = this.getValues();
                    this.mlssLabel.textContent = mlss;
                    this.tempLabel.textContent = temp;
                    
                    const { sote, aote, alpha, beta, correctionFactor } = this.calculate();
                    
                    this.chart.data.datasets[0].data = [sote, aote < 0 ? 0 : aote];
                    this.chart.update();
                    
                    this.alphaValueEl.textContent = alpha.toFixed(2);
                    this.betaValueEl.textContent = beta.toFixed(2);
                    this.correctionFactorEl.textContent = correctionFactor.toFixed(2);
                    
                    let explanationText = ``;
                    if (alpha < 0.5 && tech === 'fine_pore') {
                        explanationText += `<strong>注意：</strong>在当前高MLSS浓度下，微孔曝气的α因子显著降低，导致实际效率远低于标准值。这揭示了“曝气效率在需氧量最高时最低”的悖论。`;
                    } else if (tech === 'jet' || tech === 'coarse_pore') {
                        explanationText += `<strong>提示：</strong>${tech === 'jet' ? '射流' : '粗孔'}曝气技术对α因子抑制的抵抗力更强，使其在恶劣水质或高MLSS条件下表现更稳定，尽管其标准效率（SOTE）较低。`;
                    } else {
                        explanationText += `<strong>分析：</strong>您选择的参数组合展示了一个典型的市政污水处理场景。请尝试提高MLSS或选择工业废水，观察α因子和AOTE的变化。`;
                    }
                    this.explanationEl.innerHTML = explanationText;
                }
            };

            const processControl = {
                chart: null,
                tempSlider: document.getElementById('srt-temp-slider'),
                tempLabel: document.getElementById('srt-temp-label'),
                explanationEl: document.getElementById('srt-explanation'),
                srtData: {
                    20: { theory: 3.5, design: 6.0 }, 19: { theory: 3.8, design: 6.5 }, 18: { theory: 4.1, design: 7.0 }, 17: { theory: 4.4, design: 7.5 }, 16: { theory: 4.7, design: 8.0 },
                    15: { theory: 5.0, design: 8.5 }, 14: { theory: 5.8, design: 9.8 }, 13: { theory: 6.5, design: 11.0 }, 12: { theory: 7.0, design: 12.0 }, 11: { theory: 8.0, design: 14.0 },
                    10: { theory: 8.8, design: 15.0 }, 9: { theory: 10.0, design: 17.5 }, 8: { theory: 11.5, design: 20.0 }
                },

                init: function() {
                    const ctx = document.getElementById('srtChart').getContext('2d');
                    this.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['最小理论SRT', '建议设计SRT'],
                            datasets: [{
                                label: '固体停留时间 (天)',
                                data: [0, 0],
                                backgroundColor: ['rgba(255, 182, 193, 0.6)', 'rgba(144, 238, 144, 0.6)'],
                                borderColor: ['rgba(255, 182, 193, 1)', 'rgba(144, 238, 144, 1)'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true, max: 25, title: { display: true, text: '天数' }}},
                            plugins: { legend: { display: false } }
                        }
                    });

                    this.tempSlider.addEventListener('input', this.update.bind(this));
                    this.update();
                },
                
                update: function() {
                    const temp = parseInt(this.tempSlider.value);
                    this.tempLabel.textContent = temp;
                    
                    const data = this.srtData[temp];
                    this.chart.data.datasets[0].data = [data.theory, data.design];
                    this.chart.update();
                    
                    let explanationHtml = `<p class="text-gray-600">在 <strong class="text-blue-600">${temp}°C</strong> 时，为确保完全硝化，系统SRT至少需要维持在 <strong class="text-green-600">${data.design} 天</strong> (已包含安全系数)。</p>`;
                    if (temp < 12) {
                        explanationHtml += `<p class="mt-2 text-red-700"><strong>警告：</strong>在低温条件下，硝化菌生长极为缓慢。如此长的SRT意味着需要维持更高的MLSS浓度或拥有更大的反应池容积。这会显著增加曝气能耗（α因子降低）并对二沉池造成更大的固体负荷。</p>`;
                    } else {
                        explanationHtml += `<p class="mt-2 text-gray-600">这是一个相对温和的运行条件。但请注意，SRT是战略性控制参数，它通过影响F/M比，间接决定了微生物种群、污泥沉降性，甚至胞外聚合物(EPS)的产生，从而可能二次影响α因子。</p>`;
                    }
                    this.explanationEl.innerHTML = explanationHtml;
                }
            };

            const integratedExplorer = {
                container: document.getElementById('concept-map-container'),
                titleEl: document.getElementById('concept-title'),
                textEl: document.getElementById('concept-text'),
                nodes: {
                    load: { text: '进水负荷', pos: 'top-4 left-1/2 -translate-x-1/2', info: '驱动整个系统的根本变量。BOD和氨氮的流量和浓度变化，直接决定了生物需氧量(AOR)。' },
                    our_aur: { text: 'OUR / AUR', pos: 'top-28 left-1/2 -translate-x-1/2', info: '生物需氧量的实时体现。高负荷导致高OUR/AUR，直接要求曝气系统提供更多氧气。' },
                    aote: { text: '曝气效率 (AOTE)', pos: 'top-1/2 -translate-y-1/2 left-1/4 -translate-x-1/2', info: '曝气系统在现场的实际氧转移效率。它决定了满足需氧量需要多少风量，是能耗的关键。' },
                    alpha: { text: 'α因子', pos: 'top-1/2 -translate-y-1/2 left-3/4 -translate-x-1/2', info: '衡量污水对氧转移抑制程度的关键系数。受污染物、曝气技术和MLSS浓度的严重影响。α因子越低，曝气越困难。' },
                    mlss: { text: 'MLSS', pos: 'bottom-28 left-1/4 -translate-x-1/2', info: '曝气池中的生物质浓度。操作员通过调节它来达到目标SRT。它具有双重影响：增加MLSS能提高处理能力，但会因粘度增加而显著降低α因子，导致曝气能耗上升。' },
                    srt: { text: 'SRT', pos: 'bottom-4 left-1/4 -translate-x-1/2', info: '固体停留时间，工艺控制的核心。决定微生物群落（如是否能硝化），与食微比(F/M)成反比。为保证低温硝化，必须延长SRT。' },
                    power: { text: '功率密度 P/V', pos: 'bottom-28 left-3/4 -translate-x-1/2', info: '输入系统的能量。分为混合功率和曝气功率。曝气功率是满足AOR的结果，是能耗大户，并与AOTE和α因子直接相关。' },
                },
                connections: [
                    { from: 'load', to: 'our_aur', type: 'direct' },
                    { from: 'our_aur', to: 'aote', type: 'direct' },
                    { from: 'our_aur', to: 'power', type: 'direct' },
                    { from: 'alpha', to: 'aote', type: 'direct' },
                    { from: 'mlss', to: 'alpha', type: 'negative' },
                    { from: 'srt', to: 'mlss', type: 'direct' },
                    { from: 'load', to: 'alpha', type: 'negative' },
                    { from: 'mlss', to: 'our_aur', type: 'direct' }
                ],
                
                init: function() {
                    this.drawMap();
                    this.addEventListeners();
                },

                drawMap: function() {
                    let html = '';
                    Object.entries(this.nodes).forEach(([id, node]) => {
                        html += `<div id="node-${id}" data-id="${id}" class="concept-node absolute p-3 bg-white rounded-lg shadow-lg text-center ${node.pos} w-32">
                                    <h4 class="font-bold text-gray-800">${node.text}</h4>
                                 </div>`;
                    });
                    this.container.innerHTML = html;
                    
                    this.connections.forEach(conn => {
                        const fromNode = document.getElementById(`node-${conn.from}`);
                        const toNode = document.getElementById(`node-${conn.to}`);
                        const fromRect = fromNode.getBoundingClientRect();
                        const toRect = toNode.getBoundingClientRect();
                        const containerRect = this.container.getBoundingClientRect();

                        const x1 = fromRect.left + fromRect.width / 2 - containerRect.left;
                        const y1 = fromRect.top + fromRect.height / 2 - containerRect.top;
                        const x2 = toRect.left + toRect.width / 2 - containerRect.left;
                        const y2 = toRect.top + toRect.height / 2 - containerRect.top;

                        const distance = Math.sqrt((x2 - x1)**2 + (y2 - y1)**2);
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

                        const line = document.createElement('div');
                        line.classList.add('concept-line');
                        line.dataset.from = conn.from;
                        line.dataset.to = conn.to;
                        line.style.width = `${distance}px`;
                        line.style.height = '3px';
                        line.style.left = `${x1}px`;
                        line.style.top = `${y1}px`;
                        line.style.transformOrigin = '0 0';
                        line.style.transform = `rotate(${angle}deg)`;
                        
                        if(conn.type === 'negative') line.style.backgroundColor = '#FECACA';

                        this.container.appendChild(line);
                    });
                },

                addEventListeners: function() {
                    this.container.querySelectorAll('.concept-node').forEach(nodeEl => {
                        nodeEl.addEventListener('click', () => {
                            this.updateSelection(nodeEl.dataset.id);
                        });
                    });
                },

                updateSelection: function(selectedId) {
                    this.container.querySelectorAll('.concept-node, .concept-line').forEach(el => el.classList.remove('active'));

                    document.getElementById(`node-${selectedId}`).classList.add('active');

                    this.container.querySelectorAll('.concept-line').forEach(line => {
                        if (line.dataset.from === selectedId || line.dataset.to === selectedId) {
                            line.classList.add('active');
                            document.getElementById(`node-${line.dataset.from}`).classList.add('active');
                            document.getElementById(`node-${line.dataset.to}`).classList.add('active');
                        }
                    });

                    const nodeInfo = this.nodes[selectedId];
                    this.titleEl.textContent = nodeInfo.text;
                    this.textEl.textContent = nodeInfo.info;
                }
            };
            
            navigation.setupNavHighlighting();
            microbialActivity.init();
            aerationAnalysis.init();
            processControl.init();
            integratedExplorer.init();
        });
    </script>

</body>
</html>
